{% extends "base.html" %}

{% load staticfiles i18n %}

{% block content-header %}
    <h1>
        Список источников данных
    </h1>
{% endblock %}


{% block content %}
    <div class="row">
        <div class="col-lg-12">
            <button type="button" class="btn btn-info"><a href="{% url "etl:etl.add" %}"><i class="fa fa-align-left"></i></a></button>
            <div class="box">
                <div class="box-header">
                    <h3 class="box-title">Источники данных</h3>

                    <div class="box-tools">
                        <div class="input-group" style="width: 150px;">
                            <input type="text" name="table_search" class="form-control input-sm pull-right"  id="search"
                                   placeholder="Search"  onchange="search()" value="{{search}}">

                            <div class="input-group-btn">
                                <button class="btn btn-sm btn-default" onclick="search()"><i class="fa fa-search"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /.box-header -->
                <div class="box-body table-responsive no-padding">
                    <table class="table table-hover" id="source_table" data-url="{% url "etl:index" %}">
                        <tbody>
                        <tr>
                            <th>ID</th>
                            <th>Название</th>
                            <th>Логин</th>
                            <th>Хост</th>
                            <th>Порт</th>
                            <th>Действия</th>
                        </tr>
                        {% for row in sources %}
                            <tr>
                                <td>{{ row.id }}</td>
                                <td>{{ row.name }}</td>
                                <td>{{ row.login }}</td>
                                <td>{{ row.host }}</td>
                                <td>{{ row.port }}</td>
                                <td>
                                    <a href="{% url "etl:etl.edit" row.id %}"><i class="fa fa-edit text-blue"></i></a> &nbsp;
                                    <a href="javascript:void(0)"
                                       onclick="removeSource('{% url "etl:etl.delete" row.id %}')"><i class="fa fa-remove text-danger"></i></a>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>

                {% if sources.paginator.num_pages > 1 %}
                    <div class="box-body">
                        <div class="text-center">
                            <ul class="pagination">
                                {% if sources.has_previous %}
                                    <li><a class="fa fa-chevron-left" href="{{url}}{{page|add:-1}}"></a></li>
                                {% endif %}
                                {% for i in range%}
                                    <li
                                    {% if i == page %}
                                        class="active"
                                    {% endif %}
                                    ><a href="{{url}}{{i}}">{{i|add:1}}</a></li>
                                {% endfor %}
                                {% if sources.has_next %}
                                    <li><a class="fa fa-chevron-right" href="{{url}}{{page|add:1}}"></a></li>
                                {% endif %}
                            </ul>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <script>
        function search(){
            var etlUrl = $('#source_table').attr('data-url'),
                search = $('#search').val();
            document.location = etlUrl+'?search='+search;
        }

        function removeSource(url){
            $.confirm({
                text: "Вы действительно хотите удалить источник?",
                confirm: function(button) {
                    $.post(url,
                        {csrfmiddlewaretoken: csrftoken},
                        function(data) {
                            window.location = data.redirect_url;
                        }
                    );
                },
                title:"Удаление источника",
                confirmButton: "Удалить",
                cancelButton: "Отмена"
            });
        }
    </script>

{% endblock content %}

